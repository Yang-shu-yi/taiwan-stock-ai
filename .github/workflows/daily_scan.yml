name: Daily Stock Scan ğŸ“ˆ

# è¨­å®šè§¸ç™¼æ™‚æ©Ÿ
on:
  schedule:
    # è¨­å®šæ¯å¤©ä¸‹åˆ 15:00 (å°ç£æ™‚é–“) åŸ·è¡Œ
    # GitHub ä½¿ç”¨ UTC æ™‚é–“ï¼Œå°ç£æ˜¯ UTC+8ï¼Œæ‰€ä»¥ 15:00 - 8 = 07:00
    # æ ¼å¼: åˆ† æ™‚ æ—¥ æœˆ æ˜ŸæœŸ (1-5 ä»£è¡¨é€±ä¸€åˆ°é€±äº”)
    - cron: '0 7 * * 1-5'
  
  # å…è¨±æ‰‹å‹•é»æ“ŠæŒ‰éˆ•è§¸ç™¼ (æ–¹ä¾¿æ¸¬è©¦ç”¨)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. ä¸‹è¼‰ä½ çš„ç¨‹å¼ç¢¼
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. è¨­å®š Python ç’°å¢ƒ
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    # 3. å®‰è£å¥—ä»¶ (åŒ…å« lxml)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4. åŸ·è¡Œæƒæç¨‹å¼
    - name: Run Batch Scan
      run: python batch_scan.py

    # 5. æª¢æŸ¥æ˜¯å¦æœ‰è³‡æ–™è®Šå‹•ï¼Œä¸¦è‡ªå‹•å­˜æª” (Commit & Push)
    - name: Commit and Push changes
      run: |
        git config --global user.name "GitHub Action Bot"
        git config --global user.email "actions@github.com"
        git add stock_database.json
        # å¦‚æœæœ‰è®Šå‹•æ‰ Commitï¼Œæ²’è®Šå‹•å°±ä¸åšä»»ä½•äº‹ (é¿å…å ±éŒ¯)
        git commit -m "ğŸ¤– Auto-update stock data $(date +'%Y-%m-%d')" || exit 0
        git push